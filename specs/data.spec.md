# AI Newsroom Data Storage Strategy

## Overview
This document outlines the Redis data storage strategy for the AI Newsroom application. All data will be stored in Redis using keys with structured naming conventions and appropriate data types for efficient access and querying.

## Data Types and Structures

### Editor
The editor is a single entity with bio, prompt, AI model configuration, and pricing information.

**Keys:**
- `editor:bio` - String containing the editor's biography
- `editor:prompt` - String containing the editor's system prompt
- `editor:message_slice_count` - String containing message slice count for AI processing
- `editor:input_token_cost` - String containing the cost per million input tokens for AI API
- `editor:output_token_cost` - String containing the cost per million output tokens for AI API
- `article_generation:period_minutes` - String containing article generation period in minutes
- `article_generation:last_time` - String containing last article generation timestamp (milliseconds since epoch)
- `event_generation:period_minutes` - String containing event generation period in minutes
- `event_generation:last_time` - String containing last event generation timestamp (milliseconds since epoch)
- `ai:model_name` - String containing the AI model name

### Reporters
Reporters are stored with their beats, prompts, and enabled status. Each reporter has a unique ID.

**Keys:**
- `reporters` - Set containing all reporter IDs
- `reporter:{id}:beats` - Set containing the reporter's beat strings
- `reporter:{id}:prompt` - String containing the reporter's system prompt
- `reporter:{id}:enabled` - String ("true"/"false") indicating if reporter is enabled

### Articles
Articles are generated by reporters and stored with metadata including prompts and source messages.

**Keys:**
- `articles:{reporter_id}` - Sorted set where:
  - Score: Generation time (milliseconds since epoch)
  - Member: Article ID
- `article:{article_id}:headline` - String containing the article headline
- `article:{article_id}:body` - String containing the article body
- `article:{article_id}:time` - String containing the generation time (milliseconds since epoch)
- `article:{article_id}:prompt` - String containing the prompt used to generate the article
- `article:{article_id}:message_ids` - JSON string array of message IDs used as sources
- `article:{article_id}:message_texts` - JSON string array of message texts used as sources

### Events
Events are generated by reporters and stored with facts and metadata.

**Keys:**
- `events:{reporter_id}` - Sorted set where:
  - Score: Created time (milliseconds since epoch)
  - Member: Event ID
- `event:{event_id}:title` - String containing the event title
- `event:{event_id}:created_time` - String containing the creation time (milliseconds since epoch)
- `event:{event_id}:updated_time` - String containing the last update time (milliseconds since epoch)
- `event:{event_id}:facts` - JSON string array of event facts
- `event:{event_id}:where` - String containing where the event took place (optional)
- `event:{event_id}:when` - String containing date and time the event took place (optional)

### Newspaper Editions
Newspaper editions are generated by the editor every 3 hours, containing selected articles.

**Keys:**
- `editions` - Sorted set where:
  - Score: Generation time (milliseconds since epoch)
  - Member: Edition ID
- `edition:{edition_id}:stories` - Set containing article IDs included in this edition
- `edition:{edition_id}:time` - String containing the generation time (milliseconds since epoch)
- `edition:{edition_id}:prompt` - String containing the prompt used to generate the edition

### Daily Editions
Daily editions are generated by the editor every 24 hours, containing selected newspaper editions and detailed content.

**Keys:**
- `daily_editions` - Sorted set where:
  - Score: Generation time (milliseconds since epoch)
  - Member: Daily Edition ID
- `daily_edition:{daily_edition_id}:editions` - Set containing edition IDs included in this daily edition
- `daily_edition:{daily_edition_id}:time` - String containing the generation time (milliseconds since epoch)
- `daily_edition:{daily_edition_id}:front_page_headline` - String containing front page headline
- `daily_edition:{daily_edition_id}:front_page_article` - String containing front page article
- `daily_edition:{daily_edition_id}:newspaper_name` - String containing newspaper name
- `daily_edition:{daily_edition_id}:model_feedback_positive` - String containing positive model feedback about the prompt
- `daily_edition:{daily_edition_id}:model_feedback_negative` - String containing negative model feedback about the prompt
- `daily_edition:{daily_edition_id}:topics` - JSON string containing topics array with detailed news stories
- `daily_edition:{daily_edition_id}:prompt` - String containing the prompt used to generate the daily edition

### Ads
Ads are user-created entries with bidding information and prompt content.

**Keys:**
- `ads` - Set containing all ad IDs
- `ad:{ad_id}:name` - String containing ad name
- `ad:{ad_id}:bid_price` - String containing bid price as number
- `ad:{ad_id}:prompt_content` - String containing ad prompt content
- `ad:{ad_id}:user_id` - String containing user ID who created the ad

### Users
Users are stored with authentication and role information.

**Keys:**
- `users` - Set containing all user IDs
- `user:{user_id}:email` - String containing user email
- `user:{user_id}:password_hash` - String containing hashed password
- `user:{user_id}:role` - String containing user role ("admin"/"editor"/"reporter"/"user")
- `user:{user_id}:created_at` - String containing creation timestamp (milliseconds since epoch)
- `user:{user_id}:last_login_at` - String containing last login timestamp (milliseconds since epoch)
- `user:{user_id}:has_reader` - String ("true"/"false") indicating reader access permission
- `user:{user_id}:has_reporter` - String ("true"/"false") indicating reporter access permission
- `user:{user_id}:has_editor` - String ("true"/"false") indicating editor access permission
- `user_by_email:{email}` - String containing user ID for email lookup

### KPIs
Key Performance Indicators are stored to track AI API usage and costs.

**Keys:**
- `kpi:{name}:value` - String containing the current KPI value (numbers stored as strings)
- `kpi:{name}:last_updated` - String containing timestamp of last update (milliseconds since epoch)

## Key Naming Conventions
- Use colons (`:`) as separators for hierarchical key names
- Use descriptive prefixes (`editor:`, `reporter:`, `article:`, `edition:`, `daily_edition:`, `event:`, `ad:`, `user:`, `ai:`)
- Include IDs in curly braces for dynamic key generation
- Use consistent data types (Strings for text, Sets for collections, Sorted Sets for time-ordered data)
- Use reverse lookup patterns like `user_by_email:{email}` for efficient lookups by non-ID fields
- Store JSON data as strings for complex objects (facts arrays, topics arrays, message arrays)

## Data Access Patterns
- **Editor lookup**: Direct key access with `GET editor:bio`, `GET editor:prompt`, `GET editor:input_token_cost`, `GET editor:output_token_cost`, and other editor configuration keys
- **Reporter enumeration**: `SMEMBERS reporters` to get all reporter IDs
- **Reporter details**: Direct key access with `SMEMBERS reporter:{id}:beats`, `GET reporter:{id}:prompt`, and `GET reporter:{id}:enabled`
- **Recent articles by reporter**: `ZREVRANGE articles:{reporter_id} 0 -1 WITHSCORES` for most recent articles
- **Articles in time range**: `ZRANGEBYSCORE articles:{reporter_id} {start_time} {end_time}`
- **Article details**: Direct key access with `GET article:{article_id}:headline`, `GET article:{article_id}:body`, etc.
- **Recent events by reporter**: `ZREVRANGE events:{reporter_id} 0 -1 WITHSCORES` for most recent events
- **Event details**: Direct key access with `GET event:{event_id}:title`, `GET event:{event_id}:facts`, etc.
- **Edition lookup**: `ZREVRANGE editions 0 -1 WITHSCORES` for most recent editions
- **Edition details**: `SMEMBERS edition:{edition_id}:stories` for articles in edition
- **Daily edition lookup**: `ZREVRANGE daily_editions 0 -1 WITHSCORES` for most recent daily editions
- **Daily edition details**: `SMEMBERS daily_edition:{daily_edition_id}:editions` for editions in daily edition
- **Ad enumeration**: `SMEMBERS ads` to get all ad IDs
- **Ad details**: Direct key access with `GET ad:{ad_id}:name`, `GET ad:{ad_id}:bid_price`, etc.
- **User enumeration**: `SMEMBERS users` to get all user IDs
- **User lookup by email**: `GET user_by_email:{email}` to get user ID
- **User details**: Direct key access with `GET user:{user_id}:email`, `GET user:{user_id}:role`, etc.

## Performance Considerations
- Use connection pooling for Redis connections
- Implement proper error handling for Redis operations
- Consider using Redis pipelines for batch operations
- Monitor memory usage as data accumulates over time
- Implement data cleanup strategies for old articles/editions if needed

## Data Persistence
- Configure Redis persistence (RDB or AOF) based on data criticality requirements
- Consider backup strategies for Redis data
- Plan for data migration if schema changes are needed

## Security
- Use Redis authentication with username/password as specified
- Implement proper access controls
- Encrypt sensitive data if required
- Monitor Redis access logs for security

This strategy provides efficient storage and retrieval of all newsroom data while maintaining clear organization and scalability.
